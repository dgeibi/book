<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>3.&#xA0;&#x9759;&#x6001;&#x5E93;</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><link rel="start" href="index.html" title="Linux C&#x7F16;&#x7A0B;&#x4E00;&#x7AD9;&#x5F0F;&#x5B66;&#x4E60;"><link rel="up" href="ch20.html" title="&#x7B2C;&#xA0;20&#xA0;&#x7AE0;&#xA0;&#x94FE;&#x63A5;&#x8BE6;&#x89E3;"><link rel="prev" href="ch20s02.html" title="2.&#xA0;&#x5B9A;&#x4E49;&#x548C;&#x58F0;&#x660E;"><link rel="next" href="ch20s04.html" title="4.&#xA0;&#x5171;&#x4EAB;&#x5E93;"><meta name="viewport" content="width=device-width, initial-scale=1"></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">3.&#xA0;&#x9759;&#x6001;&#x5E93;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch20s02.html">&#x4E0A;&#x4E00;&#x9875;</a>&#xA0;</td><th width="60%" align="center">&#x7B2C;&#xA0;20&#xA0;&#x7AE0;&#xA0;&#x94FE;&#x63A5;&#x8BE6;&#x89E3;</th><td width="20%" align="right">&#xA0;<a accesskey="n" href="ch20s04.html">&#x4E0B;&#x4E00;&#x9875;</a></td></tr></tbody></table><hr></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2789183"></a>3.&#xA0;&#x9759;&#x6001;&#x5E93;</h2></div></div></div><p>&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x628A;&#x4E00;&#x7EC4;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x6210;&#x4E00;&#x4E2A;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x5E93;&#x5728;&#x5F88;&#x591A;&#x9879;&#x76EE;&#x4E2D;&#x90FD;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x4F8B;&#x5982;<code class="literal">libc</code>&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5E93;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x7A0B;&#x5E8F;&#x4E2D;&#x90FD;&#x4F1A;&#x7528;&#x5230;<code class="literal">libc</code>&#x4E2D;&#x7684;&#x5E93;&#x51FD;&#x6570;&#xFF08;&#x4F8B;&#x5982;<code class="literal">printf</code>&#xFF09;&#xFF0C;&#x4E5F;&#x4F1A;&#x7528;&#x5230;<code class="literal">libc</code>&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF08;&#x4F8B;&#x5982;&#x4EE5;&#x540E;&#x8981;&#x8BB2;&#x5230;&#x7684;<code class="literal">environ</code>&#x53D8;&#x91CF;&#xFF09;&#x3002;&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x600E;&#x4E48;&#x521B;&#x5EFA;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x5E93;&#x3002;</p><p>&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x7528;<code class="literal">stack.c</code>&#x7684;&#x4F8B;&#x5B50;&#x3002;&#x4E3A;&#x4E86;&#x4FBF;&#x4E8E;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x628A;<code class="literal">stack.c</code>&#x62C6;&#x6210;&#x56DB;&#x4E2A;&#x7A0B;&#x5E8F;&#x6587;&#x4EF6;&#xFF08;&#x867D;&#x7136;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x592A;&#x5927;&#x5FC5;&#x8981;&#xFF09;&#xFF0C;&#x628A;<code class="literal">main.c</code>&#x6539;&#x5F97;&#x7B80;&#x5355;&#x4E00;&#x4E9B;&#xFF0C;&#x5934;&#x6587;&#x4EF6;<code class="literal">stack.h</code>&#x4E0D;&#x53D8;&#xFF0C;&#x672C;&#x8282;&#x7528;&#x5230;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p><pre class="programlisting">/* stack.c */
char stack[512];
int top = -1;</pre><pre class="programlisting">/* push.c */
extern char stack[512];
extern int top;

void push(char c)
{
	stack[++top] = c;
}</pre><pre class="programlisting">/* pop.c */
extern char stack[512];
extern int top;

char pop(void)
{
	return stack[top--];
}</pre><pre class="programlisting">/* is_empty.c */
extern int top;

int is_empty(void)
{
	return top == -1;
}</pre><pre class="programlisting">/* stack.h */
#ifndef STACK_H
#define STACK_H
extern void push(char);
extern char pop(void);
extern int is_empty(void);
#endif</pre><pre class="programlisting">/* main.c */
#include &lt;stdio.h&gt;
#include &quot;stack.h&quot;

int main(void)
{
	push(&apos;a&apos;);
	return 0;
}</pre><p>&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x662F;&#xFF1A;</p><pre class="screen">$ tree
.
|-- main.c
`-- stack
    |-- is_empty.c
    |-- pop.c
    |-- push.c
    |-- stack.c
    `-- stack.h

1 directory, 6 files</pre><p>&#x6211;&#x4EEC;&#x628A;<code class="literal">stack.c</code>&#x3001;<code class="literal">push.c</code>&#x3001;<code class="literal">pop.c</code>&#x3001;<code class="literal">is_empty.c</code>&#x7F16;&#x8BD1;&#x6210;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#xFF1A;</p><pre class="screen">$ gcc -c stack/stack.c stack/push.c stack/pop.c stack/is_empty.c</pre><p>&#x7136;&#x540E;&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x5E93;<code class="literal">libstack.a</code>&#xFF1A;</p><pre class="screen">$ ar rs libstack.a stack.o push.o pop.o is_empty.o
ar: creating libstack.a</pre><p>&#x5E93;&#x6587;&#x4EF6;&#x540D;&#x90FD;&#x662F;&#x4EE5;<code class="literal">lib</code>&#x5F00;&#x5934;&#x7684;&#xFF0C;&#x9759;&#x6001;&#x5E93;&#x4EE5;<code class="literal">.a</code>&#x4F5C;&#x4E3A;&#x540E;&#x7F00;&#xFF0C;&#x8868;&#x793A;Archive&#x3002;<code class="literal">ar</code>&#x547D;&#x4EE4;&#x7C7B;&#x4F3C;&#x4E8E;<code class="literal">tar</code>&#x547D;&#x4EE4;&#xFF0C;&#x8D77;&#x4E00;&#x4E2A;&#x6253;&#x5305;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x628A;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#x6253;&#x5305;&#x6210;&#x9759;&#x6001;&#x5E93;&#x53EA;&#x80FD;&#x7528;<code class="literal">ar</code>&#x547D;&#x4EE4;&#x800C;&#x4E0D;&#x80FD;&#x7528;<code class="literal">tar</code>&#x547D;&#x4EE4;&#x3002;&#x9009;&#x9879;<code class="literal">r</code>&#x8868;&#x793A;&#x5C06;&#x540E;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x6DFB;&#x52A0;&#x5230;&#x6587;&#x4EF6;&#x5305;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5305;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x521B;&#x5EFA;&#x5B83;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5305;&#x4E2D;&#x5DF2;&#x6709;&#x540C;&#x540D;&#x6587;&#x4EF6;&#x5C31;&#x66FF;&#x6362;&#x6210;&#x65B0;&#x7684;&#x3002;<code class="literal">s</code>&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x9759;&#x6001;&#x5E93;&#x7684;&#xFF0C;&#x8868;&#x793A;&#x4E3A;&#x9759;&#x6001;&#x5E93;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#xFF0C;&#x8FD9;&#x4E2A;&#x7D22;&#x5F15;&#x88AB;&#x94FE;&#x63A5;&#x5668;&#x4F7F;&#x7528;&#x3002;<code class="literal">ranlib</code>&#x547D;&#x4EE4;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x9759;&#x6001;&#x5E93;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#xFF0C;&#x4EE5;&#x4E0A;&#x547D;&#x4EE4;&#x7B49;&#x4EF7;&#x4E8E;&#xFF1A;</p><pre class="screen">$ ar r libstack.a stack.o push.o pop.o is_empty.o
$ ranlib libstack.a</pre><p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x628A;<code class="literal">libstack.a</code>&#x548C;<code class="literal">main.c</code>&#x7F16;&#x8BD1;&#x94FE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF1A;</p><pre class="screen">$ gcc main.c -L. -lstack -Istack -o main</pre><p><code class="literal">-L</code>&#x9009;&#x9879;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#x53BB;&#x54EA;&#x91CC;&#x627E;&#x9700;&#x8981;&#x7684;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;<code class="literal">-L.</code>&#x8868;&#x793A;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x627E;&#x3002;<code class="literal">-lstack</code>&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#x8981;&#x94FE;&#x63A5;<code class="literal">libstack</code>&#x5E93;&#xFF0C;<code class="literal">-I</code>&#x9009;&#x9879;&#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#x53BB;&#x54EA;&#x91CC;&#x627E;&#x5934;&#x6587;&#x4EF6;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x5373;&#x4F7F;&#x5E93;&#x6587;&#x4EF6;&#x5C31;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x9ED8;&#x8BA4;&#x4E5F;&#x4E0D;&#x4F1A;&#x53BB;&#x627E;&#x7684;&#xFF0C;&#x6240;&#x4EE5;<code class="literal">-L.</code>&#x9009;&#x9879;&#x4E0D;&#x80FD;&#x5C11;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x9ED8;&#x8BA4;&#x4F1A;&#x627E;&#x7684;&#x76EE;&#x5F55;&#x53EF;&#x4EE5;&#x7528;<code class="literal">-print-search-dirs</code>&#x9009;&#x9879;&#x67E5;&#x770B;&#xFF1A;</p><pre class="screen">$ gcc -print-search-dirs
install: /usr/lib/gcc/i486-linux-gnu/4.3.2/
programs: =/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/:/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/:/usr/libexec/gcc/i486-linux-gnu/4.3.2/:/usr/libexec/gcc/i486-linux-gnu/:/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../i486-linux-gnu/bin/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../i486-linux-gnu/bin/
libraries: =/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../i486-linux-gnu/lib/i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../i486-linux-gnu/lib/../lib/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../i486-linux-gnu/4.3.2/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../lib/:/lib/i486-linux-gnu/4.3.2/:/lib/../lib/:/usr/lib/i486-linux-gnu/4.3.2/:/usr/lib/../lib/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../../i486-linux-gnu/lib/:/usr/lib/gcc/i486-linux-gnu/4.3.2/../../../:/lib/:/usr/lib/</pre><p>&#x5176;&#x4E2D;&#x7684;<code class="literal">libraries</code>&#x5C31;&#x662F;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x641C;&#x7D22;&#x8DEF;&#x5F84;&#x5217;&#x8868;&#xFF0C;&#x5404;&#x8DEF;&#x5F84;&#x4E4B;&#x95F4;&#x7528;<code class="literal">:</code>&#x53F7;&#x9694;&#x5F00;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x5728;&#x8FD9;&#x4E9B;&#x641C;&#x7D22;&#x8DEF;&#x5F84;&#x4EE5;&#x53CA;<code class="literal">-L</code>&#x9009;&#x9879;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x4E2D;&#x67E5;&#x627E;&#x7528;<code class="literal">-l</code>&#x9009;&#x9879;&#x6307;&#x5B9A;&#x7684;&#x5E93;&#xFF0C;&#x6BD4;&#x5982;<code class="literal">-lstack</code>&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x9996;&#x5148;&#x627E;&#x6709;&#x6CA1;&#x6709;&#x5171;&#x4EAB;&#x5E93;<code class="literal">libstack.so</code>&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5C31;&#x94FE;&#x63A5;&#x5B83;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5C31;&#x627E;&#x6709;&#x6CA1;&#x6709;&#x9759;&#x6001;&#x5E93;<code class="literal">libstack.a</code>&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5C31;&#x94FE;&#x63A5;&#x5B83;&#x3002;&#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x662F;&#x4F18;&#x5148;&#x8003;&#x8651;&#x5171;&#x4EAB;&#x5E93;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x7F16;&#x8BD1;&#x5668;&#x53EA;&#x94FE;&#x63A5;&#x9759;&#x6001;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;<code class="literal">-static</code>&#x9009;&#x9879;&#x3002;</p><p>&#x90A3;&#x4E48;&#x94FE;&#x63A5;&#x5171;&#x4EAB;&#x5E93;&#x548C;&#x94FE;&#x63A5;&#x9759;&#x6001;&#x5E93;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x5462;&#xFF1F;&#x5728;<a class="xref" href="ch19s02.html#asmc.main">&#x7B2C;&#xA0;2&#xA0;&#x8282; &#x201C;<code class="literal">main</code>&#x51FD;&#x6570;&#x548C;&#x542F;&#x52A8;&#x4F8B;&#x7A0B;&#x201D;</a>&#x8BB2;&#x8FC7;&#xFF0C;&#x5728;&#x94FE;&#x63A5;<code class="literal">libc</code>&#x5171;&#x4EAB;&#x5E93;&#x65F6;&#x53EA;&#x662F;&#x6307;&#x5B9A;&#x4E86;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5668;&#x548C;&#x8BE5;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x8981;&#x7684;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x7684;&#x505A;&#x94FE;&#x63A5;&#xFF0C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;<code class="literal">main</code>&#x4E2D;&#x8C03;&#x7528;&#x7684;<code class="literal">libc</code>&#x5E93;&#x51FD;&#x6570;&#x4ECD;&#x7136;&#x662F;&#x672A;&#x5B9A;&#x4E49;&#x7B26;&#x53F7;&#xFF0C;&#x8981;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x505A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x3002;&#x800C;&#x5728;&#x94FE;&#x63A5;&#x9759;&#x6001;&#x5E93;&#x65F6;&#xFF0C;&#x94FE;&#x63A5;&#x5668;&#x4F1A;&#x628A;&#x9759;&#x6001;&#x5E93;&#x4E2D;&#x7684;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#x53D6;&#x51FA;&#x6765;&#x548C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x771F;&#x6B63;&#x94FE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x53CD;&#x6C47;&#x7F16;&#x770B;&#x4E0A;&#x4E00;&#x6B65;&#x751F;&#x6210;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;<code class="literal">main</code>&#xFF1A;</p><pre class="screen">$ objdump -d main
...
08048394 &lt;main&gt;:
 8048394:       8d 4c 24 04             lea    0x4(%esp),%ecx
 8048398:       83 e4 f0                and    $0xfffffff0,%esp
 804839b:       ff 71 fc                pushl  -0x4(%ecx)
...
080483c0 &lt;push&gt;:
 80483c0:       55                      push   %ebp
 80483c1:       89 e5                   mov    %esp,%ebp
 80483c3:       83 ec 04                sub    $0x4,%esp</pre><p>&#x6709;&#x610F;&#x601D;&#x7684;&#x662F;&#xFF0C;<code class="literal">main.c</code>&#x53EA;&#x8C03;&#x7528;&#x4E86;<code class="literal">push</code>&#x8FD9;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x94FE;&#x63A5;&#x751F;&#x6210;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#x4E5F;&#x53EA;&#x6709;<code class="literal">push</code>&#x800C;&#x6CA1;&#x6709;<code class="literal">pop</code>&#x548C;<code class="literal">is_empty</code>&#x3002;&#x8FD9;&#x662F;&#x4F7F;&#x7528;&#x9759;&#x6001;&#x5E93;&#x7684;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#xFF0C;&#x94FE;&#x63A5;&#x5668;&#x53EF;&#x4EE5;&#x4ECE;&#x9759;&#x6001;&#x5E93;&#x4E2D;&#x53EA;&#x53D6;&#x51FA;&#x9700;&#x8981;&#x7684;&#x90E8;&#x5206;&#x6765;&#x505A;&#x94FE;&#x63A5;&#x3002;&#x5982;&#x679C;&#x662F;&#x76F4;&#x63A5;&#x628A;&#x90A3;&#x4E9B;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#x548C;<code class="literal">main.c</code>&#x7F16;&#x8BD1;&#x94FE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF1A;</p><pre class="screen">$ gcc main.c stack.o push.o pop.o is_empty.o -Istack -o main</pre><p>&#x5219;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x7684;&#x51FD;&#x6570;&#x4E5F;&#x4F1A;&#x94FE;&#x63A5;&#x8FDB;&#x6765;&#x3002;&#x5F53;&#x7136;&#x53E6;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x9759;&#x6001;&#x5E93;&#x53EA;&#x9700;&#x5199;&#x4E00;&#x4E2A;&#x5E93;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x4E00;&#x957F;&#x4E32;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#x540D;&#x3002;</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a accesskey="p" href="ch20s02.html">&#x4E0A;&#x4E00;&#x9875;</a>&#xA0;</td><td width="20%" align="center"><a accesskey="u" href="ch20.html">&#x4E0A;&#x4E00;&#x7EA7;</a></td><td width="40%" align="right">&#xA0;<a accesskey="n" href="ch20s04.html">&#x4E0B;&#x4E00;&#x9875;</a></td></tr><tr><td width="40%" align="left" valign="top">2.&#xA0;&#x5B9A;&#x4E49;&#x548C;&#x58F0;&#x660E;&#xA0;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#x8D77;&#x59CB;&#x9875;</a></td><td width="40%" align="right" valign="top">&#xA0;4.&#xA0;&#x5171;&#x4EAB;&#x5E93;</td></tr></tbody></table></div>
</body></html>