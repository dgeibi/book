<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>7.&#xA0;ioctl</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><link rel="start" href="index.html" title="Linux C&#x7F16;&#x7A0B;&#x4E00;&#x7AD9;&#x5F0F;&#x5B66;&#x4E60;"><link rel="up" href="ch28.html" title="&#x7B2C;&#xA0;28&#xA0;&#x7AE0;&#xA0;&#x6587;&#x4EF6;&#x4E0E;I/O"><link rel="prev" href="ch28s06.html" title="6.&#xA0;fcntl"><link rel="next" href="ch28s08.html" title="8.&#xA0;mmap"><meta name="viewport" content="width=device-width, initial-scale=1"></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">7.&#xA0;ioctl</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch28s06.html">&#x4E0A;&#x4E00;&#x9875;</a>&#xA0;</td><th width="60%" align="center">&#x7B2C;&#xA0;28&#xA0;&#x7AE0;&#xA0;&#x6587;&#x4EF6;&#x4E0E;I/O</th><td width="20%" align="right">&#xA0;<a accesskey="n" href="ch28s08.html">&#x4E0B;&#x4E00;&#x9875;</a></td></tr></tbody></table><hr></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2853359"></a>7.&#xA0;ioctl</h2></div></div></div><p><code class="literal">ioctl</code>&#x7528;&#x4E8E;&#x5411;&#x8BBE;&#x5907;&#x53D1;&#x63A7;&#x5236;&#x548C;&#x914D;&#x7F6E;&#x547D;&#x4EE4;&#xFF0C;&#x6709;&#x4E9B;&#x547D;&#x4EE4;&#x4E5F;&#x9700;&#x8981;&#x8BFB;&#x5199;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x662F;&#x4E0D;&#x80FD;&#x7528;<code class="literal">read</code>/<code class="literal">write</code>&#x8BFB;&#x5199;&#x7684;&#xFF0C;&#x79F0;&#x4E3A;Out-of-band<a id="id2853385" class="indexterm"></a>&#x6570;&#x636E;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code class="literal">read</code>/<code class="literal">write</code>&#x8BFB;&#x5199;&#x7684;&#x6570;&#x636E;&#x662F;in-band&#x6570;&#x636E;&#xFF0C;&#x662F;I/O&#x64CD;&#x4F5C;&#x7684;&#x4E3B;&#x4F53;&#xFF0C;&#x800C;<code class="literal">ioctl</code>&#x547D;&#x4EE4;&#x4F20;&#x9001;&#x7684;&#x662F;&#x63A7;&#x5236;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x662F;&#x8F85;&#x52A9;&#x7684;&#x6570;&#x636E;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4E32;&#x53E3;&#x7EBF;&#x4E0A;&#x6536;&#x53D1;&#x6570;&#x636E;&#x901A;&#x8FC7;<code class="literal">read</code>/<code class="literal">write</code>&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E32;&#x53E3;&#x7684;&#x6CE2;&#x7279;&#x7387;&#x3001;&#x6821;&#x9A8C;&#x4F4D;&#x3001;&#x505C;&#x6B62;&#x4F4D;&#x901A;&#x8FC7;<code class="literal">ioctl</code>&#x8BBE;&#x7F6E;&#xFF0C;A/D&#x8F6C;&#x6362;&#x7684;&#x7ED3;&#x679C;&#x901A;&#x8FC7;<code class="literal">read</code>&#x8BFB;&#x53D6;&#xFF0C;&#x800C;A/D&#x8F6C;&#x6362;&#x7684;&#x7CBE;&#x5EA6;&#x548C;&#x5DE5;&#x4F5C;&#x9891;&#x7387;&#x901A;&#x8FC7;<code class="literal">ioctl</code>&#x8BBE;&#x7F6E;&#x3002;</p><pre class="programlisting">#include &lt;sys/ioctl.h&gt;

int ioctl(int d, int request, ...);</pre><p><code class="literal">d</code>&#x662F;&#x67D0;&#x4E2A;&#x8BBE;&#x5907;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;<code class="literal">request</code>&#x662F;<code class="literal">ioctl</code>&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x53D8;&#x53C2;&#x6570;&#x53D6;&#x51B3;&#x4E8E;<code class="literal">request</code>&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x53D8;&#x91CF;&#x6216;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6307;&#x9488;&#x3002;&#x82E5;&#x51FA;&#x9519;&#x5219;&#x8FD4;&#x56DE;-1&#xFF0C;&#x82E5;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;&#x5176;&#x4ED6;&#x503C;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x662F;&#x53D6;&#x51B3;&#x4E8E;<code class="literal">request</code>&#x3002;</p><p>&#x4EE5;&#x4E0B;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;<code class="literal">TIOCGWINSZ</code>&#x547D;&#x4EE4;&#x83B7;&#x5F97;&#x7EC8;&#x7AEF;&#x8BBE;&#x5907;&#x7684;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x3002;</p><pre class="programlisting">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/ioctl.h&gt;

int main(void)
{
	struct winsize size;
	if (isatty(STDOUT_FILENO) == 0)
		exit(1);
	if(ioctl(STDOUT_FILENO, TIOCGWINSZ, &amp;size)&lt;0) {
		perror(&quot;ioctl TIOCGWINSZ error&quot;);
		exit(1);
	}
	printf(&quot;%d rows, %d columns\n&quot;, size.ws_row, size.ws_col);
	return 0;
}</pre><p>&#x5728;&#x56FE;&#x5F62;&#x754C;&#x9762;&#x7684;&#x7EC8;&#x7AEF;&#x91CC;&#x591A;&#x6B21;&#x6539;&#x53D8;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#x7684;&#x5927;&#x5C0F;&#x5E76;&#x8FD0;&#x884C;&#x8BE5;&#x7A0B;&#x5E8F;&#xFF0C;&#x89C2;&#x5BDF;&#x7ED3;&#x679C;&#x3002;</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a accesskey="p" href="ch28s06.html">&#x4E0A;&#x4E00;&#x9875;</a>&#xA0;</td><td width="20%" align="center"><a accesskey="u" href="ch28.html">&#x4E0A;&#x4E00;&#x7EA7;</a></td><td width="40%" align="right">&#xA0;<a accesskey="n" href="ch28s08.html">&#x4E0B;&#x4E00;&#x9875;</a></td></tr><tr><td width="40%" align="left" valign="top">6.&#xA0;fcntl&#xA0;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#x8D77;&#x59CB;&#x9875;</a></td><td width="40%" align="right" valign="top">&#xA0;8.&#xA0;mmap</td></tr></tbody></table></div>
</body></html>